<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitch Chat - –ö–∞—Å—Ç–æ–º–Ω—ã–π –¥–∏–∑–∞–π–Ω</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Google Fonts –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="chat-container">
        <div class="chat-messages" id="chat-messages">
        </div>
        
        <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–±—Ä–∞–Ω—ã –¥–ª—è OBS -->
    </div>
    
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ jChat -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tinycolor2@1.4.2/dist/tinycolor-min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reconnecting-websocket@4.4.0/dist/reconnecting-websocket.min.js"></script>
    
    <script src="script.js"></script>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞...');
            
            // –°–æ–∑–¥–∞–µ–º —á–∞—Ç
            window.twitchChat = new TwitchChat();
            
            // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
            await new Promise(resolve => {
                const checkSettings = () => {
                    if (window.twitchChat.settingsLoaded) {
                        resolve();
                    } else {
                        setTimeout(checkSettings, 50);
                    }
                };
                checkSettings();
            });
            
            console.log('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            
            // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
            const urlParams = new URLSearchParams(window.location.search);
            const channel = urlParams.get('channel');
            const fontFamily = urlParams.get('fontFamily');
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —à—Ä–∏—Ñ—Ç –∏–∑ URL –µ—Å–ª–∏ –µ—Å—Ç—å
            if (fontFamily) {
                // –î–µ–∫–æ–¥–∏—Ä—É–µ–º URL –ø–∞—Ä–∞–º–µ—Ç—Ä
                const decodedFontFamily = decodeURIComponent(fontFamily);
                console.log('üî§ –ü—Ä–∏–º–µ–Ω—è–µ–º —à—Ä–∏—Ñ—Ç –∏–∑ URL:', decodedFontFamily);
                window.twitchChat.settings.fontFamily = decodedFontFamily;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —à—Ä–∏—Ñ—Ç –µ—Å–ª–∏ –æ–Ω –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
                try {
                    await window.twitchChat.loadFont(decodedFontFamily);
                    console.log('‚úÖ –®—Ä–∏—Ñ—Ç –∏–∑ URL –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                } catch (error) {
                    console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à—Ä–∏—Ñ—Ç–∞ –∏–∑ URL:', error.message);
                }
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            console.log('üé® –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏...');
            await window.twitchChat.applySettings();
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ–º —à—Ä–∏—Ñ—Ç –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É —á–∞—Ç–∞
            if (window.twitchChat.chatMessagesElement) {
                console.log('üî§ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ–º —à—Ä–∏—Ñ—Ç –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É —á–∞—Ç–∞');
                window.twitchChat.chatMessagesElement.style.fontFamily = window.twitchChat.settings.fontFamily;
                window.twitchChat.chatMessagesElement.style.fontSize = window.twitchChat.settings.fontSize + 'px';
                window.twitchChat.chatMessagesElement.style.fontWeight = window.twitchChat.settings.fontWeight;
                window.twitchChat.chatMessagesElement.style.lineHeight = window.twitchChat.settings.lineHeight;
                window.twitchChat.chatMessagesElement.style.letterSpacing = window.twitchChat.settings.letterSpacing + 'px';
                window.twitchChat.chatMessagesElement.style.color = window.twitchChat.settings.fontColor;
            }
            
            // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –∫–∞–Ω–∞–ª—É
            if (channel) {
                window.twitchChat.settings.channel = channel;
                window.twitchChat.connectToChat();
                console.log('‚úÖ –ß–∞—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –∫–∞–Ω–∞–ª—É:', channel);
            } else {
                console.log('‚ö†Ô∏è –ö–∞–Ω–∞–ª –Ω–µ —É–∫–∞–∑–∞–Ω –≤ URL');
            }
            
            console.log('üéâ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —à—Ä–∏—Ñ—Ç–æ–≤ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(async () => {
                console.log('üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —à—Ä–∏—Ñ—Ç–æ–≤...');
                if (window.twitchChat && window.twitchChat.chatMessagesElement) {
                    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ–º —à—Ä–∏—Ñ—Ç –µ—â–µ —Ä–∞–∑
                    window.twitchChat.chatMessagesElement.style.fontFamily = window.twitchChat.settings.fontFamily;
                    window.twitchChat.chatMessagesElement.style.fontSize = window.twitchChat.settings.fontSize + 'px';
                    window.twitchChat.chatMessagesElement.style.fontWeight = window.twitchChat.settings.fontWeight;
                    window.twitchChat.chatMessagesElement.style.lineHeight = window.twitchChat.settings.lineHeight;
                    window.twitchChat.chatMessagesElement.style.letterSpacing = window.twitchChat.settings.letterSpacing + 'px';
                    window.twitchChat.chatMessagesElement.style.color = window.twitchChat.settings.fontColor;
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º —à—Ä–∏—Ñ—Ç –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Å–æ–æ–±—â–µ–Ω–∏—è–º
                    const messages = window.twitchChat.chatMessagesElement.querySelectorAll('.message');
                    messages.forEach(message => {
                        message.style.fontFamily = window.twitchChat.settings.fontFamily;
                        message.style.fontSize = window.twitchChat.settings.fontSize + 'px';
                        message.style.fontWeight = window.twitchChat.settings.fontWeight;
                        message.style.lineHeight = window.twitchChat.settings.lineHeight;
                        message.style.letterSpacing = window.twitchChat.settings.letterSpacing + 'px';
                        message.style.color = window.twitchChat.settings.fontColor;
                        
                        // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫ –≤–ª–æ–∂–µ–Ω–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–∞–º
                        const usernameElement = message.querySelector('.username');
                        const textElement = message.querySelector('.text');
                        
                        if (usernameElement) {
                            usernameElement.style.fontFamily = window.twitchChat.settings.fontFamily;
                            usernameElement.style.fontSize = window.twitchChat.settings.fontSize + 'px';
                            usernameElement.style.fontWeight = window.twitchChat.settings.fontWeight;
                            usernameElement.style.lineHeight = window.twitchChat.settings.lineHeight;
                            usernameElement.style.letterSpacing = window.twitchChat.settings.letterSpacing + 'px';
                        }
                        
                        if (textElement) {
                            textElement.style.fontFamily = window.twitchChat.settings.fontFamily;
                            textElement.style.fontSize = window.twitchChat.settings.fontSize + 'px';
                            textElement.style.fontWeight = window.twitchChat.settings.fontWeight;
                            textElement.style.lineHeight = window.twitchChat.settings.lineHeight;
                            textElement.style.letterSpacing = window.twitchChat.settings.letterSpacing + 'px';
                        }
                    });
                    
                    console.log('‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —à—Ä–∏—Ñ—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
                }
            }, 2000);
        });
    </script>
</body>
</html>
